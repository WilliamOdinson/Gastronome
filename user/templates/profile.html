{% extends "common/base.html" %}

{% load static %}

{% block title %}My Profile{% endblock %}

{% block content %}
<main class="pattern">
  <div class="wrapper">
    <div class="container margin_80_55">

      <div class="row justify-content-center g-4">
        <div class="col-lg-10">

          <!-- profile card -->
          <div class="card shadow-sm mb-4">
            <div class="card-body d-flex flex-column flex-md-row align-items-md-center">
              <div class="flex-grow-1">
                <h2 class="card-title mb-1">
                  <i class="material-icons text-primary align-middle me-1 fs-3">account_circle</i>
                  {{ user_obj.display_name }}
                </h2>
                <p class="text-muted mb-0">Member since {{ user_obj.yelping_since }}</p>
              </div>

              <ul class="list-inline mb-0 mt-3 mt-md-0">
                <li class="list-inline-item me-3">
                  <span class="h5 mb-0">{{ user_obj.review_count }}</span><br>
                  <small class="text-muted">Reviews</small>
                </li>
                <li class="list-inline-item me-3">
                  <span class="h5 mb-0">{{ user_obj.fans }}</span><br>
                  <small class="text-muted">Fans</small>
                </li>
                <li class="list-inline-item">
                  <span class="h5 mb-0">{{ user_obj.average_stars|floatformat:1 }}</span><br>
                  <small class="text-muted">Avg&nbsp;Stars</small>
                </li>
              </ul>
            </div>
          </div>

          <!-- User info -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="material-icons align-middle me-1">info</i>User information
              </h5>
            </div>
            <div class="card-body">
              <dl class="row mb-0">
                <dt class="col-sm-4">Email</dt>
                <dd class="col-sm-8">{{ user_obj.email }}</dd>

                <dt class="col-sm-4">Elite years</dt>
                <dd class="col-sm-8">
                  {% if user_obj.elite_years %}
                    {{ user_obj.elite_years|join:", " }}
                  {% else %} Not Yet. {% endif %}
                </dd>
              </dl>
            </div>
          </div>

          <!-- Compliments --> 
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="material-icons align-middle me-1">thumb_up</i>Compliments
              </h5>
            </div>
            <div class="card-body">
              {% with u=user_obj %}
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Hot <span class="badge bg-primary ms-1">{{ u.compliment_hot }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  More <span class="badge bg-primary ms-1">{{ u.compliment_more }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Profile <span class="badge bg-primary ms-1">{{ u.compliment_profile }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Cute <span class="badge bg-primary ms-1">{{ u.compliment_cute }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  List <span class="badge bg-primary ms-1">{{ u.compliment_list }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Note <span class="badge bg-primary ms-1">{{ u.compliment_note }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Plain <span class="badge bg-primary ms-1">{{ u.compliment_plain }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Cool <span class="badge bg-primary ms-1">{{ u.compliment_cool }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Funny <span class="badge bg-primary ms-1">{{ u.compliment_funny }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Writer <span class="badge bg-primary ms-1">{{ u.compliment_writer }}</span>
                </span>
                <span class="badge bg-primary-soft text-primary fw-normal me-2 mb-2">
                  Photos <span class="badge bg-primary ms-1">{{ u.compliment_photos }}</span>
                </span>
              {% endwith %}
            </div>
          </div>

          <!-- Reviews --> 
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="material-icons align-middle me-1">rate_review</i>Your reviews
              </h5>
            </div>
            <div class="card-body">
              {% if reviews %}
                <div class="list-group">
                  {% for review in reviews %}
                    <div class="list-group-item">
                      <div class="d-flex justify-content-between">
                        <div class="me-3">
                          <h6 class="mb-1">
                            {{ review.business.name }}
                            <span class="badge bg-warning text-dark ms-2">{{ review.stars }} ★</span>
                          </h6>
                          <small class="text-muted">{{ review.date|date:"Y-m-d" }}</small>
                          <p class="mb-0 mt-2">{{ review.text }}</p>
                        </div>

                        <form method="post"
                              action="{% url 'review:delete_review' review.review_id %}"
                              onsubmit="return confirm('Delete this review?');">
                          {% csrf_token %}
                          <button type="submit"
                                  class="btn btn-sm btn-outline-danger"
                                  title="Delete review">
                            <i class="material-icons align-middle">delete</i>
                          </button>
                        </form>
                      </div>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="mb-0 text-muted">You have no reviews yet.</p>
              {% endif %}
            </div>
          </div>

          <!-- Tips ─ -->
          <div class="card shadow-sm mb-4">
            <div class="card-header bg-light">
              <h5 class="mb-0">
                <i class="material-icons align-middle me-1">lightbulb</i>Your tips
              </h5>
            </div>
            <div class="card-body">
              {% if tips %}
                <div class="list-group">
                  {% for tip in tips %}
                    <div class="list-group-item">
                      <h6 class="mb-1">{{ tip.business.name }}</h6>
                      <small class="text-muted">{{ tip.date|date:"Y-m-d" }}</small>
                      <p class="mb-0 mt-2">{{ tip.text }}</p>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <p class="mb-0 text-muted">You have no tips yet.</p>
              {% endif %}
            </div>
          </div>

          <!-- Logout ─ -->
          <form method="post" action="{% url 'user:logout' %}" class="text-center">
            {% csrf_token %}
            <button type="submit" class="btn btn-outline-danger">
              <i class="material-icons align-middle me-1">logout</i>Logout
            </button>
          </form>

        </div>
      </div>
    </div>
  </div>
</main>
{% endblock %}

{% block extra_js %}{% endblock %}
