<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{{ business.name }} - Details</title>
</head>
<body>
    <h1>{{ business.name }}</h1>
    <p><strong>Address:</strong> {{ business.address }}, {{ business.city }}, {{ business.state }} {{ business.postal_code }}</p>
    <p><strong>Rating:</strong> {{ business.stars }} stars ({{ business.review_count }} reviews)</p>
    <p><strong>Status:</strong> {{ business.is_open|yesno:"Open,Closed" }}</p>

    <h2>Categories</h2>
    {% if business.categories.exists %}
    <ul>
        {% for category in business.categories.all %}
            <li>{{ category.name }}</li>
        {% endfor %}
    </ul>
    {% else %}
        <p>No categories listed</p>
    {% endif %}

    {% if request.user.is_authenticated %}
        <a href="{% url 'review:create_review' business.business_id %}" class="btn btn-primary">Write a review</a>
    {% else %}
        <a href="{% url 'user:login' %}?next={% url 'review:create_review' business.business_id %}" class="btn btn-secondary">Write a review after logging in!</a>
    {% endif %}

    <h2>Hours</h2>
    {% if business.hours.exists %}
    <ul>
        {% for hour in business.hours.all %}
            <li>{{ hour.day }}: {{ hour.open_time }} - {{ hour.close_time }}</li>
        {% endfor %}
    </ul>
    {% else %}
        <p>No hours available</p>
    {% endif %}

    <h2>Photos</h2>
    {% if business.photos.exists %}
    <div style="display: flex; flex-wrap: wrap;">
        {% for photo in business.photos.all %}
            <div style="margin: 10px;">
                <img src="{{ photo.image_url }}" alt="{{ photo.label }}" width="200">
                <p>{{ photo.label }}<br>{{ photo.caption }}</p>
            </div>
        {% endfor %}
    </div>
    {% else %}
        <p>No photos available</p>
    {% endif %}

    <h2>Recent Check-ins</h2>
    {% if recent_checkins %}
    <ul>
        {% for checkin in recent_checkins %}
            <li>{{ checkin.checkin_time }}</li>
        {% endfor %}
    </ul>
    {% else %}
        <p>No check-in records</p>
    {% endif %}

    <h2>Reviews</h2>
    {% if reviews %}
        <ul>
        {% for review in reviews %}
            <li style="margin-bottom: 20px;">
                <strong>{{ review.user.display_name }}</strong> 
                rated <strong>{{ review.stars }} stars</strong> 
                on {{ review.date|date:"Y-m-d" }}<br>
                <p>{{ review.text|linebreaks }}</p>
                {% if review.auto_score %}
                    <small>Model predicted score: {{ review.auto_score|floatformat:1 }}</small>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No reviews yet. Be the first to review!</p>
    {% endif %}
    
</body>
</html>
